<!doctype html>
<html>
  <body>
    <h2>ğŸš€ RAG ìŠ¤íŠ¸ë¦¬ë° í…ŒìŠ¤íŠ¸</h2>
    <input
      type="text"
      id="question"
      style="width: 300px"
      placeholder="ì§ˆë¬¸ì„ ì…ë ¥í•˜ì„¸ìš”..."
    />
    <button onclick="ask()">ì§ˆë¬¸í•˜ê¸°</button>
    <div
      id="response"
      style="
        margin-top: 20px;
        border: 1px solid #ccc;
        padding: 10px;
        min-height: 100px;
        white-space: pre-wrap;
      "
    ></div>

    <script>
      async function ask() {
        const btn = document.querySelector("button"); // ë²„íŠ¼ ì„ íƒ
        const question = document.getElementById("question").value;
        const resDiv = document.getElementById("response");

        btn.disabled = true; // 1. ë‹µë³€ ì‹œì‘í•  ë•Œ ë²„íŠ¼ ë¹„í™œì„±í™”
        resDiv.innerText = "ğŸ” ë°ì´í„°ë¥¼ ì°¾ëŠ” ì¤‘...";

        try {
          const response = await fetch("http://localhost:8000/chat/stream", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ question: question }),
          });

          resDiv.innerText = ""; // ëŒ€ê¸° ë¬¸êµ¬ ì‚­ì œ
          const reader = response.body.getReader();
          const decoder = new TextDecoder();

          while (true) {
            const { done, value } = await reader.read();
            if (done) break;
            const chunk = decoder.decode(value, { stream: true });
            resDiv.innerText += chunk;
          }
        } catch (e) {
          resDiv.innerText = "âŒ ì—ëŸ¬ ë°œìƒ: " + e.message;
        } finally {
          btn.disabled = false; // 2. ë‹µë³€ ëë‚˜ë©´ ë²„íŠ¼ ë‹¤ì‹œ í™œì„±í™”
        }
      }
    </script>
  </body>
</html>
